var gdjs;(function(n){const l=new n.Logger("PIXI Image manager"),h=(s,e)=>{l.error("Unable to load file "+s+" with error:",e||"(unknown error)")},u=(s,e)=>{!s||e.smoothed||(s.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST)},c=(s,e)=>{e&&!e.smoothed&&(s.magFilter=THREE.NearestFilter,s.minFilter=THREE.NearestFilter)},g=(s,e,r)=>{const t=s.get(e);return t&&t.kind===r?t:null};class x{constructor(e,r){this._resources=new Map,this.setResources(e),this._resourcesLoader=r,this._invalidTexture=PIXI.Texture.from("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAFElEQVQoU2P8z/D/PwMewDgyFAAApMMX8Zi0uXAAAAAASUVORK5CYIIA"),this._loadedTextures=new Hashtable,this._loadedThreeTextures=new Hashtable,this._loadedThreeMaterials=new Hashtable}setResources(e){this._resources.clear();for(const r of e)(r.kind==="image"||r.kind==="video")&&this._resources.set(r.name,r)}getPIXITexture(e){if(this._loadedTextures.containsKey(e)){const r=this._loadedTextures.get(e);if(r.valid)return r;l.error("Texture for "+e+" is not valid anymore (or never was).")}return this._invalidTexture}getThreeTexture(e){const r=this._loadedThreeTextures.get(e);if(r)return r;const t=this.getPIXITexture(e);if(!this._resourcesLoader._runtimeGame.getRenderer().getPIXIRenderer())throw new Error("No PIXI renderer was found.");const o=t.baseTexture.resource.source;if(!(o instanceof HTMLImageElement))throw new Error(`Can't load texture for resource "${e}" as it's not an image.`);const a=new THREE.Texture(o);a.magFilter=THREE.LinearFilter,a.minFilter=THREE.LinearFilter,a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping,a.colorSpace=THREE.SRGBColorSpace,a.needsUpdate=!0;const T=g(this._resources,e,"image");return c(a,T),this._loadedThreeTextures.put(e,a),a}getThreeMaterial(e,{useTransparentTexture:r,forceBasicMaterial:t}){const i=`${e}|${r?1:0}|${t?1:0}`,o=this._loadedThreeMaterials.get(i);if(o)return o;const a=t?new THREE.MeshBasicMaterial({map:this.getThreeTexture(e),side:r?THREE.DoubleSide:THREE.FrontSide,transparent:r}):new THREE.MeshStandardMaterial({map:this.getThreeTexture(e),side:r?THREE.DoubleSide:THREE.FrontSide,transparent:r,metalness:0});return this._loadedThreeMaterials.put(i,a),a}getPIXIVideoTexture(e){return this._loadedTextures.containsKey(e)?this._loadedTextures.get(e):this._invalidTexture}getInvalidPIXITexture(){return this._invalidTexture}async loadTextures(e){let r=0;return await Promise.all([...this._resources.values()].map(async t=>{try{if(t.kind==="video")await new Promise((i,o)=>{const a=PIXI.Texture.from(this._resourcesLoader.getFullUrl(t.file),{resourceOptions:{crossOrigin:this._resourcesLoader.checkIfCredentialsRequired(t.file)?"use-credentials":"anonymous",autoPlay:!1}}).on("error",d=>{o(d)});a.baseTexture.on("loaded",()=>{this._loadedTextures.put(t.name,a),u(a,t),i()}).on("error",d=>{o(d)})});else{const i=PIXI.Texture.from(this._resourcesLoader.getFullUrl(t.file),{resourceOptions:{autoLoad:!1,crossOrigin:this._resourcesLoader.checkIfCredentialsRequired(t.file)?"use-credentials":"anonymous"}});await i.baseTexture.resource.load(),this._loadedTextures.put(t.name,i),u(i,t)}}catch(i){h(t.file,i)}r++,e(r,this._resources.size)})),r}}n.PixiImageManager=x,n.ImageManager=n.PixiImageManager})(gdjs||(gdjs={}));
//# sourceMappingURL=pixi-image-manager.js.map
